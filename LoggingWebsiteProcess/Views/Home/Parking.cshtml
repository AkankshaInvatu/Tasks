@model IEnumerable<LoggingWebsiteProcess.Models.ParkingModel>

@{
    ViewData["Title"] = "Parking";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parking Details</title>
</head>
<body>
    <h1>Parking Details</h1>
    <ul id="parkingList"></ul>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="~/lib/microsoft/signalr/dist/browser/signalr.min.js"></script>
    <script>
        const sessionsCount = {};
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/parkingHub")
            .configureLogging(signalR.LogLevel.Information)
            .build();

        // Start the SignalR connection
        connection.start().catch(err => console.error(err.toString()));

        connection.on("ReceiveUserData", function (parkingString) {
            // Parse the string into a JavaScript object
            const parking = JSON.parse(parkingString);

            // Extract the ParkingId property from the received data
            const parkingId = parking.ParkingId;
            console.log(parkingId);

            // Increment the sessions count for the parking ID
            sessionsCount[parkingId] = (sessionsCount[parkingId] || 0) + 1;

            console.log(sessionsCount);

            // Update the list item with the new sessions count
            const listItem = `<li>Parking ID: ${parkingId}, Sessions: ${sessionsCount[parkingId]}</li>`;

            console.log(listItem);

            // Check if the list item already exists for this parking ID
            const existingItem = $(`#parkingList li[data-parking-id="${parkingId}"]`);
            console.log(existingItem);

            // If the list item already exists, update it; otherwise, append a new one
            if (existingItem.length > 0) {
                existingItem.html(listItem);
            } else {
                $('#parkingList').append(`<li data-parking-id="${parkingId}">${listItem}</li>`);
            }
        });
    </script>
</body>
</html>

